<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>Floating Chat Input with Curve</title>  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  
<style>  
body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-image: url("https://i.ibb.co/HfvQJj50/Screenshot-20250730-222749.jpg");
    background-repeat: no-repeat;
    background-position: center top;
    background-size: cover;
    background-color: #f9f9f9;
    font-family: Arial, sans-serif;
    height: 100vh;
}
.chat-input-container {  
    position: fixed;  
    bottom: 10px;  
    left: 49%;  
    transform: translateX(-50%);  
    display: flex;  
    align-items: flex-end;  
    gap: 8px;  
    z-index: 1000;  
    transition: bottom 0.3s ease;  
    width: 95% !important;  
}  
.chat-input-container.displaying-picker {  
    bottom: 328px; /* For emoji picker */  
}  
.chat-input-container.keyboard-active {  
    bottom: 4px; /* Adjust this value based on typical keyboard height */  
}  
.message-bubble {  
    background: #fff;  
    display: flex;  
    align-items: flex-end;  
    flex: 1;  
    padding: 10px 12px;  
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);  
    border-radius: 30px;  
    position: relative;  
    min-height: 34px;
}  
.message-bubble::after {  
    content: '';  
    position: absolute;  
    bottom: 15px;  
    right: -3px;  
    width: 15px;  
    height: 15px;  
    background-color: #fff;  
    transform: rotate(45deg);  
    border-radius: 0 4px 0 0;  
    box-shadow: 2px -2px 6px rgba(0,0,0,0.1);  
    z-index: -1;  
}  
.message-bubble .icon {  
    font-size: 20px;  
    color: #555;  
    cursor: pointer;
    flex-shrink: 0;
    margin-bottom: 2px;
}  
.message-input {
    flex: 1;
    border: none;
    outline: none;
    padding: 8px;
    font-size: 16px;
    margin: 0 6px;
    background: transparent;
    color: #000;
    white-space: pre-wrap;
    overflow-wrap: break-word; /* modern replacement for word-wrap */
    word-break: break-word;    /* additional fallback */
    min-height: 18px;
}
.message-input[contenteditable][data-placeholder]:empty::before {  
    content: attr(data-placeholder);  
    color: #999;  
    pointer-events: none;  
    display: block;  
}
svg#arrowSVG {
    width: 28px;
    height: 25px;
   left: -3px;
   position: relative;
}
svg#micSVG {
    width: 25px;
    height: 25px;
}    
.attach-btn {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
    top: -4px;
    margin-bottom: 2px;
}
.attach-btn i {  
    font-size: 20px;  
    color: #555;  
}  
    
i.fa-regular.fa-face-smile {
    top: -2px;
    position: relative;
}
.mic-btn {
    background: #749cbf;
    border: none;
    border-radius: 50%;
    width: 54px;
    height: 54px;
    display: flex;
    position: relative;
    top: 1.3px;
    margin-top: 3px;
    left: 10px;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    flex-shrink: 0;
}
.mic-btn i {  
    color: #fff;  
    font-size: 22px;  
}  
@media (max-width: 480px) {  
    .chat-input-container {  
        width: 90%;  
        gap: 6px;  
    }  
    .message-bubble {  
        padding: 6px 12px;  
    }  
    .mic-btn {  
        width: 50px;  
        height: 50px;  
    }  
    .message-input {  
        font-size: 15px;  
    }  
}  
.emoji-picker-container {  
    position: fixed;  
    bottom: 0;  
    left: 0;  
    width: 100%;  
    height: 377px;  
    background: #dde5e8;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);  
    z-index: 999;  
    display: flex;  
    flex-direction: column;  
    transition: transform 0.3s ease;  
    transform: translateY(100%);  
}  
.emoji-picker-container.active {  
    transform: translateY(0);  
}  
.emoji-picker-topbar {  
    width: 100%;  
    height: 50px;  
    background-color: #fff;  
}  
.emoji-picker-content {  
    flex: 1;  
    display: grid;  
    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));  
    gap: 10px;  
    padding: 15px;  
    overflow-y: auto;  
}  
.emoji-picker-content span {  
    font-size: 24px;  
    text-align: center;  
    cursor: pointer;  
    user-select: none;  
}  
.emoji-picker-navbar {  
    width: 100%;  
    height: 40px;  
    background-color: #fff;  
    border-top: 0.5px solid #ccc;  
    display: flex;  
    justify-content: center;  
    align-items: center;  
    gap: 20px;  
    padding: 0 15px;  
    box-sizing: border-box;  
    color: #777;  
}  
.emoji-picker-navbar span.active {  
    background-color: #f5f5f5;  
    color: #6a6969;  
    font-weight: bold;  
}  
.emoji-picker-navbar span {  
    padding: 6px 12px;  
    border-radius: 18px;  
    cursor: pointer;  
    font-size: 14px;  
    font-weight: normal;  
    color: #777;  
}  
</style>  
</head>  
<body>  
<div class="chat-input-container">  
    <div class="message-bubble">  
        <div class="icon" id="emoji-btn"><i class="fa-regular fa-face-smile"></i></div>  
        <div class="message-input" contenteditable="true" data-placeholder="Message" id="chat-input-div"></div>  
        <button class="attach-btn">  
            <i class="fa-solid fa-paperclip"></i>  
        </button>  
    </div>  
    <button class="mic-btn" id="mic-btn">  
        <svg id="micSVG" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.05 122.88" width="21" height="21" fill="white" style="display: inline;">  
            <path d="M59.89,20.83V52.3c0,27-37.73,27-37.73,0V20.83c0-27.77,37.73-27.77,37.73,0Zm-14.18,76V118.2a4.69,4.69,0,0,1-9.37,0V96.78a40.71,40.71,0,0,1-12.45-3.51A41.63,41.63,0,0,1,12.05,85L12,84.91A41.31,41.31,0,0,1,3.12,71.68A40.73,40.73,0,0,1,0,56a4.67,4.67,0,0,1,8-3.31l.1.1A4.68,4.68,0,0,1,9.37,56a31.27,31.27,0,0,0,2.4,12.06A32,32,0,0,0,29,85.28a31.41,31.41,0,0,0,24.13,0,31.89,31.89,0,0,0,10.29-6.9l.08-.07a32,32,0,0,0,6.82-10.22A31.27,31.27,0,0,0,72.68,56a4.69,4.69,0,0,1,9.37,0,40.65,40.65,0,0,1-3.12,15.65A41.45,41.45,0,0,1,70,85l-.09.08a41.34,41.34,0,0,1-11.75,8.18,40.86,40.86,0,0,1-12.46,3.51Z"></path>  
        </svg>  
    </button>  
</div>  

<div class="emoji-picker-container" id="emoji-picker">  
    <div class="emoji-picker-topbar"></div>  
    <div class="emoji-picker-content"></div>  
    <div class="emoji-picker-navbar">  
        <span class="nav-tab" data-tab="emoji-tab">Emoji</span>  
        <span class="nav-tab active" data-tab="gifs-tab">GIFs</span>  
        <span class="nav-tab" data-tab="stickers-tab">Stickers</span>  
    </div>  
</div>  
<script>
       const emojiBtn = document.getElementById('emoji-btn');
    const emojiPicker = document.getElementById('emoji-picker');
    const emojiPickerContent = document.querySelector('.emoji-picker-content');
    const chatInputContainer = document.querySelector('.chat-input-container');
    const chatInputDiv = document.getElementById('chat-input-div');
    const attachBtn = document.querySelector('.attach-btn');
    const micBtn = document.getElementById('mic-btn');

    // SVG definitions for microphone, arrow, and alternate mic
    const micSVG = `
        <svg id="micSVG" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.05 122.88" width="21" height="21" fill="white">
            <path d="M59.89,20.83V52.3c0,27-37.73,27-37.73,0V20.83c0-27.77,37.73-27.77,37.73,0Zm-14.18,76V118.2a4.69,4.69,0,0,1-9.37,0V96.78a40.71,40.71,0,0,1-12.45-3.51A41.63,41.63,0,0,1,12.05,85L12,84.91A41.31,41.31,0,0,1,3.12,71.68,40.73,40.73,0,0,1,0,56a4.67,4.67,0,0,1,8-3.31l.1.1A4.68,4.68,0,0,1,9.37,56a31.27,31.27,0,0,0,2.4,12.06A32,32,0,0,0,29,85.28a31.41,31.41,0,0,0,24.13,0,31.89,31.89,0,0,0,10.29-6.9l.08-.07a32,32,0,0,0,6.82-10.22A31.27,31.27,0,0,0,72.68,56a4.69,4.69,0,0,1,9.37,0,40.65,40.65,0,0,1-3.12,15.65A41.45,41.45,0,0,1,70,85l-.09.08a41.34,41.34,0,0,1-11.75,8.18,40.86,40.86,0,0,1-12.46,3.51Z"></path>
        </svg>
    `;
    const sendArrowSVG = `
        <svg id="arrowSVG" xmlns="http://www.w3.org/2000/svg" viewBox="-15 0 150 122.88" width="21" height="21">
            <g transform="rotate(40, 61.28, 61.44) translate(-5, 0)">
                <path style="fill: white; fill-rule: evenodd;" d="M2.33,44.58,117.33.37a3.63,3.63,0,0,1,5,4.56l-44,115.61h0a3.63,3.63,0,0,1-6.67.28L53.93,84.14,89.12,33.77,38.85,68.86,2.06,51.24a3.63,3.63,0,0,1,.27-6.66Z"/>
            </g>
        </svg>
    `;
    const micAltSVG = `
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" 
            d="M3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.714 22 12C22 7.28595 22 4.92893 20.5355 3.46447C19.0711 2 16.714 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447ZM7.25 12C7.25 9.37665 9.37665 7.25 12 7.25C14.6234 7.25 16.75 9.37665 16.75 12C16.75 14.6234 14.6234 16.75 12 16.75C9.37665 16.75 7.25 14.6234 7.25 12ZM8.75 12C8.75 10.2051 10.2051 8.75 12 8.75C13.7949 8.75 15.25 10.2051 15.25 12C15.25 13.7949 13.7949 15.25 12 15.25C10.2051 15.25 8.75 13.7949 8.75 12Z" 
            fill="#ffffff"></path>
        </svg>
    `;

    let isHolding = false; // global hold state flag
    let isAltMic = false; // alternate mic state
    let startX = 0;
    let currentX = 0;
    let initialLeft = 10;
    let holdTimer = null;
    let holdTriggered = false;

    function updatePlaceholder() {
        if (chatInputDiv.textContent.trim() === '') {
            chatInputDiv.setAttribute('data-placeholder', 'Message');
        } else {
            chatInputDiv.removeAttribute('data-placeholder');
        }
    }

    function startHold(e) {
        if (chatInputDiv.textContent.trim() !== '') return;

        e.preventDefault();
        e.stopPropagation();
        isHolding = true;
        micBtn.classList.add('hold-state', 'dragging');
        micBtn.style.transition = 'transform 0.05s ease';
        micBtn.style.transform = `translateX(${initialLeft}px) scale(1.76) translateY(-5px)`;

        startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
        currentX = startX;

        document.addEventListener('mousemove', onDrag, { passive: false });
        document.addEventListener('touchmove', onDrag, { passive: false });
        console.log('Recording started');
    }

    function onDrag(e) {
        if (!isHolding) return;

        e.preventDefault();
        const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
        const deltaX = clientX - startX;
        const newLeft = initialLeft + deltaX;

        if (newLeft <= initialLeft && newLeft >= -100) {
            micBtn.style.transform = `translateX(${newLeft}px) scale(1.76) translateY(-5px)`;
        }
    }

    function endHold(e) {
        if (!isHolding) return;
        isHolding = false;
        micBtn.classList.remove('hold-state', 'dragging');
        micBtn.style.transition = 'transform 0.1s ease';
        micBtn.style.transform = 'translateY(-1px)';
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('mouseup', endHold);
        document.removeEventListener('touchend', endHold);
        document.removeEventListener('touchcancel', endHold);
        console.log('Recording stopped');
    }

    // Microphone hold & tap toggle logic
    micBtn.addEventListener('mousedown', micPressStart, { passive: false });
    micBtn.addEventListener('touchstart', micPressStart, { passive: false });

    function micPressStart(e) {
        if (chatInputDiv.textContent.trim() !== '') return;

        e.preventDefault();
        holdTriggered = false;

        holdTimer = setTimeout(() => {
            holdTriggered = true;
            startHold(e);
        }, 150);

        document.addEventListener('mouseup', micPressEnd, { passive: false });
        document.addEventListener('touchend', micPressEnd, { passive: false });
    }

    function micPressEnd(e) {
        clearTimeout(holdTimer);

        if (!holdTriggered) {
            isAltMic = !isAltMic;
            micBtn.innerHTML = isAltMic ? micAltSVG : micSVG;
            updateMicButton();
        } else {
            endHold(e);
        }

        document.removeEventListener('mouseup', micPressEnd);
        document.removeEventListener('touchend', micPressEnd);
    }

    // Input handling
    chatInputDiv.addEventListener('input', () => {
        if (isHolding) return; // Don't change icons during hold

        updatePlaceholder();
        const text = chatInputDiv.textContent.trim();
        if (text !== '') {
            micBtn.innerHTML = sendArrowSVG; // arrow send icon
        } else {
            micBtn.innerHTML = isAltMic ? micAltSVG : micSVG; // restore correct mic state
        }
    });

    // Emoji picker toggle
    emojiBtn.addEventListener('click', () => {
        const isPickerActive = emojiPicker.classList.contains('active');
        if (isPickerActive) {
            emojiPicker.classList.remove('active');
            chatInputContainer.classList.remove('displaying-picker');
        } else {
            emojiPicker.classList.add('active');
            chatInputContainer.classList.add('displaying-picker');
            chatInputContainer.classList.remove('keyboard-active');
            chatInputDiv.blur();
        }
    });

    chatInputDiv.addEventListener('focus', () => {
        emojiPicker.classList.remove('active');
        chatInputContainer.classList.remove('displaying-picker');
        chatInputContainer.classList.add('keyboard-active');
        updatePlaceholder();
    });

    chatInputDiv.addEventListener('blur', () => {
        chatInputContainer.classList.remove('keyboard-active');
        updatePlaceholder();
    });

    attachBtn.addEventListener('click', () => {
        alert('Attach button clicked!');
    });

    const emojis = [];
    emojis.forEach(emoji => {
        const span = document.createElement('span');
        span.textContent = emoji;
        span.addEventListener('click', () => {
            chatInputDiv.textContent += emoji;
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(chatInputDiv);
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
            updatePlaceholder();
            micBtn.innerHTML = sendArrowSVG; // Update to send arrow when emoji is added
        });
        emojiPickerContent.appendChild(span);
    });

    // Initial setup
    updatePlaceholder();
    micBtn.innerHTML = micSVG;
</script>

</body>  
</html>
