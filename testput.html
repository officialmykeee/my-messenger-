<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Chat Input with Curve</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-image: url("https://i.ibb.co/HfvQJj50/Screenshot-20250730-222749.jpg");
            background-repeat: no-repeat;
            background-position: center top;
            background-size: cover;
            background-color: #f9f9f9;
            font-family: Arial, sans-serif;
            height: 100vh;
        }

        .chat-header {
            background: white;
            color: #333;
            padding: 0.7rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            height: 52px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1002;
        }

        .left-section {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .back-arrow {
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            transition: background-color 0.2s;
            color: #9e9e9e;
        }

        .back-arrow:hover {
            background-color: rgba(158,158,158,0.1);
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #4285f4;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
            border: 2px solid rgba(66,133,244,0.3);
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .user-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .last-seen {
            font-size: 0.85rem;
            opacity: 0.8;
            margin: 0;
        }

        .menu-icon {
            cursor: pointer;
            padding: 0.4rem;
            border-radius: 50%;
            transition: background-color 0.2s;
            color: #9e9e9e;
        }

        .menu-icon:hover {
            background-color: rgba(158,158,158,0.1);
        }

        .chat-input-container {
            position: fixed;
            bottom: -2px;
            left: 49%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            transition: bottom 0.3s ease;
            width: 95% !important;
        }

        .chat-input-container.displaying-picker {
            bottom: 328px;
        }

        .chat-input-container.keyboard-active {
            bottom: 4px;
        }

        .reply-container {
            display: none;
            background: #f0f0f0;
            border-radius: 12px;
            padding: 8px 12px;
            margin-bottom: 4px;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #749cbf;
        }

        .reply-container.active {
            display: block;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .reply-to {
            font-size: 12px;
            color: #749cbf;
            font-weight: 600;
        }

        .reply-close {
            cursor: pointer;
            color: #666;
            font-size: 14px;
            padding: 2px;
        }

        .reply-close:hover {
            color: #333;
        }

        .reply-content {
            font-size: 13px;
            color: #555;
            line-height: 1.3;
            max-height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            position: relative;
        }

        .message-bubble {
            background: #fff;
            display: flex;
            align-items: center;
            flex: 1;
            padding: 10px 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-radius: 30px;
            position: relative;
        }

        .message-bubble::after {
            content: '';
            position: absolute;
            top: auto;
            bottom: 12px;
            right: -6px;
            width: 15px;
            height: 15px;
            background-color: #fff;
            transform: translateY(0) rotate(45deg);
            border-radius: 0 4px 0 0;
            box-shadow: 2px -2px 6px rgba(0,0,0,0.1);
            z-index: -1;
        }

        .message-bubble .icon {
            font-size: 20px;
            color: #555;
            cursor: pointer;
            align-self: flex-end;
            flex-shrink: 0;
            position: relative;
            top: -5px;
        }

        .message-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 8px;
            font-size: 16px;
            margin: 0 6px;
            background: transparent;
            color: #000;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            word-break: break-word;
            min-height: 20px;
            max-height: 120px;
            box-sizing: border-box;
            line-height: 1.4;
            overflow-y: auto;
        }

        .message-input[contenteditable][data-placeholder]:empty::before {
            content: attr(data-placeholder);
            color: #999;
            pointer-events: none;
            display: block;
        }

        .attach-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            align-self: flex-end;
            flex-shrink: 0;
            top: -7px;
            position: relative;
        }

        .attach-btn i {
            font-size: 20px;
            color: #555;
        }

        .mic-btn {
            background: #749cbf;
            border: none;
            border-radius: 50%;
            width: 54px;
            height: 54px;
            display: flex;
            position: relative;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.1s ease;
            touch-action: none;
            z-index: 1001;
            align-self: flex-end;
            flex-shrink: 0;
        }

        .mic-btn.hold-state {
            transform: scale(1.76) translateY(-5px);
        }

        .mic-btn.dragging {
            transition: none;
        }

        .mic-btn svg {
            width: 21px;
            height: 21px;
            fill: white;
        }

        .recording-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 62px;
            height: 100%;
            background: #fff;
            border-radius: 30px;
            z-index: 1000;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .recording-overlay.active {
            display: block;
        }

        .emoji-picker-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 381px;
            background: #dde5e8;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 999;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            transform: translateY(100%);
        }

        .emoji-picker-container.active {
            transform: translateY(0);
        }

        .emoji-picker-topbar {
            width: 100%;
            height: 50px;
            background-color: #fff;
        }

        .emoji-picker-content {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 10px;
            padding: 15px;
            overflow-y: auto;
        }

        .emoji-picker-content span {
            font-size: 24px;
            text-align: center;
            cursor: pointer;
            user-select: none;
        }

        .emoji-picker-navbar {
            width: 100%;
            height: 40px;
            background-color: #fff;
            border-top: 0.5px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 0 15px;
            box-sizing: border-box;
            color: #777;
        }

        .emoji-picker-navbar span.active {
            background-color: #f5f5f5;
            color: #6a6969;
            font-weight: bold;
        }

        .emoji-picker-navbar span {
            padding: 6px 12px;
            border-radius: 18px;
            cursor: pointer;
            font-size: 14px;
            font-weight: normal;
            color: #777;
        }

        /* Demo button for testing reply */
        .demo-btn {
            position: fixed;
            top: 72px; /* Adjusted to be below the chat-header (52px height + 20px spacing) */
            right: 20px;
            background: #25D366;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
        }

        /* Slide to cancel styles */
        .slide-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 4px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            overflow: hidden;
            min-width: 200px;
        }

        .arrow-icon {
            width: 20px;
            height: 20px;
            opacity: 0.6;
            transition: transform 0.3s ease, opacity 0.3s ease;
            animation: pulse 2s infinite;
        }

        .slide-text {
            font-size: 16px;
            color: #666;
            font-weight: 400;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        /* Loading animation for text */
        .slide-text::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        /* Pulsing animation for arrow */
        @keyframes pulse {
            0%, 100% {
                transform: translateX(0) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translateX(-3px) scale(1.1);
                opacity: 0.8;
            }
        }

        /* Shimmer effect for text */
        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Hover effects */
        .slide-container:hover .arrow-icon {
            transform: translateX(-5px) scale(1.1);
            opacity: 0.8;
        }

        .slide-container:hover {
            transform: translate(-50%, -50%) translateY(-2px);
        }

        /* Active/pressed state */
        .slide-container:active {
            transform: translate(-50%, -50%) translateY(0) scale(0.98);
        }

        /* Desktop responsive */
        @media (min-width: 768px) {
            body {
                background-attachment: fixed;
            }
            
            .chat-header {
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .user-name {
                font-size: 1.2rem;
            }
            
            .last-seen {
                font-size: 0.9rem;
            }
            
            .avatar {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            .back-arrow, .menu-icon {
                padding: 0.5rem;
            }
            
            .demo-btn {
                top: 76px; /* Adjusted for larger header height (56px + 20px spacing) */
            }
        }

        /* Large desktop */
        @media (min-width: 1024px) {
            .chat-header {
                max-width: 1400px;
                padding: 0.8rem 1.5rem;
                height: 56px;
            }
            
            .left-section, .profile-section {
                gap: 0.8rem;
            }
            
            .avatar {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
            
            .demo-btn {
                top: 80px; /* Adjusted for larger header height (56px + 24px spacing) */
            }
        }

        /* Mobile responsive */
        @media (max-width: 480px) {
            .chat-header {
                padding: 0.6rem 0.8rem;
            }
            
            .user-name {
                font-size: 1rem;
            }
            
            .last-seen {
                font-size: 0.8rem;
            }
            
            .avatar {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .left-section, .profile-section {
                gap: 0.5rem;
            }
            
            .chat-input-container {
               width: 102% !important;
               gap: 6px;
               background: #fff;
               min-height: 52px;
            }
            
            .message-bubble {
                padding: 6px 12px;
                box-shadow: 0 2px 6px 5px rgba(0,0,0,0.1);
            }
            
            .mic-btn {
                width: 55px;
                height: 55px;
                top: -2px;
                left: 2px;
                margin-top: 2px;
            }
            
            .mic-btn.hold-state {
                transform: scale(1.9) translateY(-5px);
            }
            
            .message-input {
                font-size: 15px;
            }
            
            .reply-container {
                margin: 8px 12px 4px 12px;
                width: calc(100% - 24px);
            }
            
            .recording-overlay {
                right: 63px;
            }
            
            .slide-container {
                padding: 15px 25px;
                min-width: 180px;
            }
            
            .slide-text {
                font-size: 14px;
            }
            
            .arrow-icon {
                width: 18px;
                height: 18px;
            }
            
            .demo-btn {
                top: 68px; /* Adjusted for smaller header height (48px + 20px spacing) */
            }
        }
    </style>
</head>
<body>
    <div class="chat-header">
        <div class="left-section">
            <div class="back-arrow" onclick="goBack()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <div class="profile-section">
                <div class="avatar">
                    M
                </div>
                <div class="user-info">
                    <div style="display: flex; align-items: center; gap: 0.3rem;">
                        <h3 class="user-name">Mykeespage</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 116.87" style="width: 16px; height: 16px;">
                            <defs>
                                <style>.cls-1{fill:#3690e7;fill-rule:evenodd;}</style>
                            </defs>
                            <path class="cls-1" d="M61.37,8.24,80.43,0,90.88,17.78l20.27,4.54-2,20.53,13.73,15.58L109.2,73.87l2,20.68L91,99,80.43,116.87l-18.92-8.25-19.06,8.25L32,99.08,11.73,94.55l2-20.54L0,58.43,13.68,43,11.73,22.32l20.15-4.45L42.45,0,61.37,8.24ZM37.44,64.55c-6.07-6.53,3.25-16.26,10-10.1,2.38,2.17,5.84,5.34,8.24,7.49L74.18,39.18C80.62,32.53,90.79,42.3,84.43,49L61.2,76.72a7.13,7.13,0,0,1-9.91.44C47.35,73.41,41.57,68,37.44,64.55Z"/>
                        </svg>
                    </div>
                    <p class="last-seen">last seen Aug 22 at 07:07 AM</p>
                </div>
            </div>
        </div>

        <div class="menu-icon" onclick="openMenu()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="5" r="2" fill="currentColor"/>
                <circle cx="12" cy="12" r="2" fill="currentColor"/>
                <circle cx="12" cy="19" r="2" fill="currentColor"/>
            </svg>
        </div>
    </div>

    <button class="demo-btn" onclick="showReply()">Test Reply</button>
    
    <div class="chat-input-container">
        <div class="reply-container" id="reply-container">
            <div class="reply-header">
                <div class="reply-to" id="reply-to">You</div>
                <div class="reply-close" id="reply-close">âœ•</div>
            </div>
            <div class="reply-content" id="reply-content">Hi</div>
        </div>
        
        <div class="input-wrapper">
            <div class="message-bubble">
                <div class="icon" id="emoji-btn"><i class="fa-regular fa-face-smile"></i></div>
                <div class="message-input" contenteditable="true" data-placeholder="Message" id="chat-input-div"></div>
                <button class="attach-btn">
                    <i class="fa-solid fa-paperclip"></i>
                </button>
            </div>
            <div class="recording-overlay" id="recording-overlay"></div>
            <button class="mic-btn" id="mic-btn">
                <svg id="micSVG" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M7.25 7C7.25 4.37665 9.37665 2.25 12 2.25C14.6234 2.25 16.75 4.37665 16.75 7V11C16.75 13.6234 14.6234 15.75 12 15.75C9.37665 15.75 7.25 13.6234 7.25 11V7Z" fill="#ffffff"></path>
                        <path d="M5.75 10C5.75 9.58579 5.41421 9.25 5 9.25C4.58579 9.25 4.25 9.58579 4.25 10V11C4.25 15.0272 7.3217 18.3369 11.25 18.7142V21C11.25 21.4142 11.5858 21.75 12 21.75C12.4142 21.75 12.75 21.4142 12.75 21V18.7142C16.6783 18.3369 19.75 15.0272 19.75 11V10C19.75 9.58579 19.4142 9.25 19 9.25C18.5858 9.25 18.25 9.58579 18.25 10V11C18.25 14.4518 15.4518 17.25 12 17.25C8.54822 17.25 5.75 14.4518 5.75 11V10Z" fill="#ffffff"></path>
                    </g>
                </svg>
            </button>
        </div>
    </div>

    <div class="emoji-picker-container" id="emoji-picker">
        <div class="emoji-picker-topbar"></div>
        <div class="emoji-picker-content"></div>
        <div class="emoji-picker-navbar">
            <span class="nav-tab" data-tab="emoji-tab">Emoji</span>
            <span class="nav-tab active" data-tab="gifs-tab">GIFs</span>
            <span class="nav-tab" data-tab="stickers-tab">Stickers</span>
        </div>
    </div>

    <script>
        const emojiBtn = document.getElementById('emoji-btn');
        const emojiPicker = document.getElementById('emoji-picker');
        const emojiPickerContent = document.querySelector('.emoji-picker-content');
        const chatInputContainer = document.querySelector('.chat-input-container');
        const chatInputDiv = document.getElementById('chat-input-div');
        const attachBtn = document.querySelector('.attach-btn');
        const micBtn = document.getElementById('mic-btn');
        const recordingOverlay = document.getElementById('recording-overlay');
        
        // Reply elements
        const replyContainer = document.getElementById('reply-container');
        const replyClose = document.getElementById('reply-close');
        const replyTo = document.getElementById('reply-to');
        const replyContent = document.getElementById('reply-content');

        // SVG definitions for microphone, arrow, and alternate mic
        const micSVG = `
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                    <path d="M7.25 7C7.25 4.37665 9.37665 2.25 12 2.25C14.6234 2.25 16.75 4.37665 16.75 7V11C16.75 13.6234 14.6234 15.75 12 15.75C9.37665 15.75 7.25 13.6234 7.25 11V7Z" fill="#ffffff"></path>
                    <path d="M5.75 10C5.75 9.58579 5.41421 9.25 5 9.25C4.58579 9.25 4.25 9.58579 4.25 10V11C4.25 15.0272 7.3217 18.3369 11.25 18.7142V21C11.25 21.4142 11.5858 21.75 12 21.75C12.4142 21.75 12.75 21.4142 12.75 21V18.7142C16.6783 18.3369 19.75 15.0272 19.75 11V10C19.75 9.58579 19.4142 9.25 19 9.25C18.5858 9.25 18.25 9.58579 18.25 10V11C18.25 14.4518 15.4518 17.25 12 17.25C8.54822 17.25 5.75 14.4518 5.75 11V10Z" fill="#ffffff"></path>
                </g>
            </svg>
        `;
        const sendArrowSVG = `
            <svg id="arrowSVG" xmlns="http://www.w3.org/2000/svg" viewBox="-15 0 150 122.88" width="21" height="21">
                <g transform="rotate(40, 61.28, 61.44) translate(-5, 0)">
                    <path style="fill: white; fill-rule: evenodd;" d="M2.33,44.58,117.33.37a3.63,3.63,0,0,1,5,4.56l-44,115.61h0a3.63,3.63,0,0,1-6.67.28L53.93,84.14,89.12,33.77,38.85,68.86,2.06,51.24a3.63,3.63,0,0,1,.27-6.66Z"/>
                </g>
            </svg>
        `;
        const micAltSVG = `
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" 
                d="M3.46447 3.46447C2 4.92893 2 7.28595 2 12C2 16.714 2 19.0711 3.46447 20.5355C4.92893 22 7.28595 22 12 22C16.714 22 19.0711 22 20.5355 20.5355C22 19.0711 22 16.714 22 12C22 7.28595 22 4.92893 20.5355 3.46447C19.0711 2 16.714 2 12 2C7.28595 2 4.92893 2 3.46447 3.46447ZM7.25 12C7.25 9.37665 9.37665 7.25 12 7.25C14.6234 7.25 16.75 9.37665 16.75 12C16.75 14.6234 14.6234 16.75 12 16.75C9.37665 16.75 7.25 14.6234 7.25 12ZM8.75 12C8.75 10.2051 10.2051 8.75 12 8.75C13.7949 8.75 15.25 10.2051 15.25 12C15.25 13.7949 13.7949 15.25 12 15.25C10.2051 15.25 8.75 13.7949 8.75 12Z" 
                fill="#ffffff"></path>
            </svg>
        `;
        const slideContainerContent = `
            <div class="slide-container">
                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" 
                          stroke="currentColor" 
                          stroke-width="2" 
                          stroke-linecap="round" 
                          stroke-linejoin="round"/>
                </svg>
                <span class="slide-text">Slide to cancel</span>
            </div>
        `;

        let isHolding = false; // global hold state flag
        let isAltMic = false; // alternate mic state
        let startX = 0;
        let currentX = 0;
        let initialLeft = 10;
        let holdTimer = null;
        let holdTriggered = false;
        let soundEnabled = true; // Default value for sound control
        let volume = 100; // Default volume level

        // Sound function for microphone button
        function playButtonSound() {
            if (soundEnabled) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime); // tone pitch
                    oscillator.type = 'sine'; // wave shape

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.1 * (volume / 100), audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } catch (error) {
                    console.log('Audio not supported');
                }
            }
        }

        // Reply functionality
        function showReply(sender = "You", message = "Hi") {
            replyTo.textContent = sender;
            replyContent.textContent = message;
            replyContainer.classList.add('active');
            updatePlaceholder();
            if (!emojiPicker.classList.contains('active')) {
                chatInputDiv.focus(); // Only focus input if emoji picker is not active
            }
        }

        function hideReply() {
            replyContainer.classList.remove('active');
            updatePlaceholder();
            if (!emojiPicker.classList.contains('active')) {
                chatInputDiv.focus(); // Only focus input if emoji picker is not active
            }
        }

        // Reply close button
        replyClose.addEventListener('click', hideReply);

        // Demo function for testing
        window.showReply = showReply;

        function updatePlaceholder() {
            const hasReply = replyContainer.classList.contains('active');
            const placeholder = hasReply ? 'Type a reply' : 'Message';
            
            if (chatInputDiv.textContent.trim() === '') {
                chatInputDiv.setAttribute('data-placeholder', placeholder);
            } else {
                chatInputDiv.removeAttribute('data-placeholder');
            }
        }

        function startHold(e) {
            if (chatInputDiv.textContent.trim() !== '') return;

            e.preventDefault();
            e.stopPropagation();
            isHolding = true;
            micBtn.classList.add('hold-state', 'dragging');
            micBtn.style.transition = 'transform 0.05s ease';
            micBtn.style.transform = `translateX(${initialLeft}px) scale(1.76) translateY(-5px)`;
            recordingOverlay.classList.add('active');
            recordingOverlay.innerHTML = slideContainerContent; // Add slide-container to overlay
            playButtonSound(); // Play sound when hold state starts

            startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            currentX = startX;

            document.addEventListener('mousemove', onDrag, { passive: false });
            document.addEventListener('touchmove', onDrag, { passive: false });
            console.log('Recording started');
        }

        function onDrag(e) {
            if (!isHolding) return;

            e.preventDefault();
            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const deltaX = clientX - startX;
            const newLeft = initialLeft + deltaX;

            if (newLeft <= initialLeft && newLeft >= -100) {
                micBtn.style.transform = `translateX(${newLeft}px) scale(1.76) translateY(-5px)`;
            }
        }

        function endHold(e) {
            if (!isHolding) return;
            isHolding = false;
            micBtn.classList.remove('hold-state', 'dragging');
            micBtn.style.transition = 'transform 0.1s ease';
            micBtn.style.transform = 'translateY(-1px)';
            recordingOverlay.classList.remove('active');
            recordingOverlay.innerHTML = ''; // Clear slide-container from overlay
            playButtonSound(); // Play sound when hold state ends
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('touchmove', onDrag);
            document.removeEventListener('mouseup', endHold);
            document.removeEventListener('touchend', endHold);
            document.removeEventListener('touchcancel', endHold);
            console.log('Recording stopped');
        }

        // Microphone hold & tap toggle logic
        micBtn.addEventListener('mousedown', micPressStart, { passive: false });
        micBtn.addEventListener('touchstart', micPressStart, { passive: false });

        function micPressStart(e) {
            if (chatInputDiv.textContent.trim() !== '') return;

            e.preventDefault();
            holdTriggered = false;

            holdTimer = setTimeout(() => {
                holdTriggered = true;
                startHold(e);
            }, 150);

            document.addEventListener('mouseup', micPressEnd, { passive: false });
            document.addEventListener('touchend', micPressEnd, { passive: false });
        }

        function micPressEnd(e) {
            clearTimeout(holdTimer);

            if (!holdTriggered) {
                isAltMic = !isAltMic;
                micBtn.innerHTML = isAltMic ? micAltSVG : micSVG;
                updateMicButton();
            } else {
                endHold(e);
            }

            document.removeEventListener('mouseup', micPressEnd);
            document.removeEventListener('touchend', micPressEnd);
        }

        // Stub for undefined updateMicButton to prevent errors
        function updateMicButton() {
            // Placeholder function to avoid undefined errors
        }

        // Input handling
        chatInputDiv.addEventListener('input', () => {
            if (isHolding) return; // Don't change icons during hold

            updatePlaceholder();
            const text = chatInputDiv.textContent.trim();
            if (text !== '') {
                micBtn.innerHTML = sendArrowSVG; // arrow send icon
            } else {
                micBtn.innerHTML = isAltMic ? micAltSVG : micSVG; // restore correct mic state
            }
        });

        // Emoji picker toggle
        emojiBtn.addEventListener('click', () => {
            const isPickerActive = emojiPicker.classList.contains('active');
            if (isPickerActive) {
                emojiPicker.classList.remove('active');
                chatInputContainer.classList.remove('displaying-picker');
            } else {
                emojiPicker.classList.add('active');
                chatInputContainer.classList.add('displaying-picker');
                chatInputContainer.classList.remove('keyboard-active');
                chatInputDiv.blur();
            }
        });

        chatInputDiv.addEventListener('focus', () => {
            emojiPicker.classList.remove('active');
            chatInputContainer.classList.remove('displaying-picker');
            chatInputContainer.classList.add('keyboard-active');
            updatePlaceholder();
            const text = chatInputDiv.textContent.trim();
            if (text !== '') {
                micBtn.innerHTML = sendArrowSVG; // Ensure arrow SVG if input has text
            } else {
                micBtn.innerHTML = isAltMic ? micAltSVG : micSVG; // Restore correct mic state
            }
        });

        chatInputDiv.addEventListener('blur', () => {
            chatInputContainer.classList.remove('keyboard-active');
            updatePlaceholder();
        });

        attachBtn.addEventListener('click', () => {
            alert('Attach button clicked!');
        });

        const emojis = [];
        emojis.forEach(emoji => {
            const span = document.createElement('span');
            span.textContent = emoji;
            span.addEventListener('click', () => {
                chatInputDiv.textContent += emoji;
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(chatInputDiv);
                range.collapse(false);
                selection.removeAllRanges();
                selection.addRange(range);
                updatePlaceholder();
                micBtn.innerHTML = sendArrowSVG; // Update to send arrow when emoji is added
            });
            emojiPickerContent.appendChild(span);
        });

        // Header functions
        function goBack() {
            console.log('Back button clicked');
            // Add your back navigation logic here
            // For example: window.history.back();
        }

        function openMenu() {
            console.log('Menu button clicked');
            // Add your menu logic here
            // For example: show dropdown menu or open settings
        }

        function updateOnlineStatus(isOnline) {
            const lastSeenEl = document.querySelector('.last-seen');
            lastSeenEl.textContent = 'last seen Aug 22 at 07:07 AM';
            lastSeenEl.style.color = '';
        }

        function updateUrl() {
            history.pushState(null, '', '/@Mykeespage');
        }

        // Initial setup
        updatePlaceholder();
        micBtn.innerHTML = micSVG;
        window.addEventListener('load', updateUrl);
    </script>
</body>
</html>
